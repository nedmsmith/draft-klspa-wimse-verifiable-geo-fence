<?xml version="1.0" encoding="UTF-8"?>
<svg width="900" height="520" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" font-family="Arial, Helvetica, sans-serif">
  <rect width="900" height="520" fill="#fff"/>
  <!-- Title -->
  <text x="450" y="40" font-size="26" font-weight="bold" text-anchor="middle">Control Plane End-to-End Workflow</text>

  <!-- Entities -->
  <rect x="60" y="90" width="180" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="10"/>
  <text x="150" y="120" font-size="16" font-weight="bold" text-anchor="middle">Host Platform</text>
  <text x="150" y="140" font-size="13" text-anchor="middle">(TPM, Sensors)</text>

  <rect x="340" y="90" width="180" height="60" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="10"/>
  <text x="430" y="120" font-size="16" font-weight="bold" text-anchor="middle">Workload Identity Agent</text>
  <text x="430" y="140" font-size="13" text-anchor="middle">(IMA, Attestation)</text>

  <rect x="620" y="90" width="180" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="10"/>
  <text x="710" y="120" font-size="16" font-weight="bold" text-anchor="middle">Workload Identity Manager</text>
  <text x="710" y="140" font-size="13" text-anchor="middle">(Remote Verifier)</text>

  <!-- Step 1: Boot/Platform Attestation -->
  <text x="150" y="180" font-size="14" text-anchor="middle" fill="#1976d2">1. Boot/Platform Attestation</text>
  <line x1="150" y1="150" x2="150" y2="200" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="100" y="200" width="100" height="30" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" rx="5"/>
  <text x="150" y="220" font-size="12" text-anchor="middle">TCGLog, PCRs</text>

  <line x1="200" y1="215" x2="340" y2="120" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 2: Agent Attestation -->
  <text x="430" y="180" font-size="14" text-anchor="middle" fill="#388e3c">2. Agent Attestation</text>
  <line x1="430" y1="150" x2="430" y2="200" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="380" y="200" width="100" height="30" fill="#e8f5e9" stroke="#388e3c" stroke-width="1" rx="5"/>
  <text x="430" y="220" font-size="12" text-anchor="middle">IMA, AK, EK</text>

  <line x1="480" y1="215" x2="620" y2="120" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 3: Workload Key Attestation -->
  <text x="430" y="270" font-size="14" text-anchor="middle" fill="#388e3c">3. Workload Key Attestation</text>
  <line x1="430" y1="230" x2="430" y2="280" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="380" y="280" width="100" height="30" fill="#e8f5e9" stroke="#388e3c" stroke-width="1" rx="5"/>
  <text x="430" y="300" font-size="12" text-anchor="middle">Workload Key</text>

  <line x1="480" y1="295" x2="620" y2="120" stroke="#388e3c" stroke-width="2" stroke-dasharray="4,4" marker-end="url(#arrow)"/>

  <!-- Step 4: Geolocation Gathering -->
  <text x="150" y="350" font-size="14" text-anchor="middle" fill="#1976d2">4. Geolocation Gathering</text>
  <line x1="150" y1="230" x2="150" y2="370" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="100" y="370" width="100" height="30" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" rx="5"/>
  <text x="150" y="390" font-size="12" text-anchor="middle">Sensors, OS APIs</text>

  <line x1="200" y1="385" x2="340" y2="120" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 5: Geolocation Manager (optional) -->
  <rect x="340" y="370" width="180" height="60" fill="#f3e5f5" stroke="#8e24aa" stroke-width="2" rx="10"/>
  <text x="430" y="400" font-size="16" font-weight="bold" text-anchor="middle">Geolocation Manager</text>
  <text x="430" y="420" font-size="13" text-anchor="middle">(Composition, Change Tracking)</text>
  <line x1="430" y1="310" x2="430" y2="370" stroke="#8e24aa" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="520" y1="400" x2="710" y2="150" stroke="#8e24aa" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="600" y="380" font-size="12" fill="#8e24aa">Host Composition</text>

  <!-- Step 6: Workload Attestation & Verification -->
  <text x="710" y="200" font-size="14" text-anchor="middle" fill="#f57c00">5. Attestation & Verification</text>
  <line x1="710" y1="150" x2="710" y2="220" stroke="#f57c00" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="660" y="220" width="100" height="30" fill="#fff3e0" stroke="#f57c00" stroke-width="1" rx="5"/>
  <text x="710" y="240" font-size="12" text-anchor="middle">Verify, Issue IDs</text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 L2,5 Z" fill="#333" />
    </marker>
  </defs>
</svg>
